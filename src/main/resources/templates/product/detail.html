<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org" th:replace="~{/layout/layout::dynamic(~{::body})}">

<head>
    <meta charset="UTF-8" />
    <title>GreenFarm</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    <div class="container-fluid shop-detail ">
        <div class="pt-3">

            <div th:object="${item}" class="row">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page" th:text="*{productname}"></li>
                    </ol>
                </nav>
                <div class="col-lg-6">
                    <img th:src="@{|*{image}|}" alt="" style="width: 500px" height="400px">
                </div>
                <div class="col-lg-6">
                    <div class="text-left mb-3 pb-3">
                        <h3 th:text="*{productname}" class="text-uppercase mt-3"></h3>
                        <h2 class="mb-3" style="font-weight: 300; color: #80bb01; font-size: 28px">
                            <span th:text="*{#numbers.formatDecimal(price, 0, 'COMMA', 0, 'POINT')} + 'đ'" style="color: #999; text-decoration: line-through"></span> <span th:text="*{#numbers.formatDecimal(price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
                        </h2>
                        <p th:text="*{description}" class="product-description mb-3"></p>
                        <div class="cart-button mt-5 mb-5 d-flex">
                            <div class="pro-qty mr-3 mb-xs-3 d-flex">
                                <input type="text" value="1" class="pr-3" />
                                <div class="d-inline-block">
                                    <a href="#" class="inc qty-btn">+</a> <a href="#" class="dec qty-btn">-</a>
                                </div>
                            </div>
                            <button class="add-to-cart-button">
								<i class="fas fa-shopping-cart"></i> Add to Cart
							</button>

                        </div>
                        <div class="categories ">
                            <h5>
                                CATEGORIES: <span><a th:text="*{category.categoryname}"></span>
                            </h5>
                            <button id="review-button" class="add-to-cart-button">
								<i class="fas fa-pencil-alt">  Đánh giá sản phẩm </i>
							</button>

                        </div>
                    </div>
                </div>
            </div>




            <div id="wapper">
                <div class=" mb-3 pb-3">
                    <h1>SẢN PHẨM LIÊN QUAN</h1>
                </div>

                <div class="row slider" th:object="${item}">
                    <div class="col-md-12 col-sm-12 col-xs-12 slide" th:each="p : *{category.products}">
                        <div class="wap-items-ss brbox">
                            <a th:href="@{|/product/detail/${p.productid}|}" class="wap-ss-img"> <img th:src="@{|${p.image}|}" alt="Product Image">
                            </a>
                            <div class="textleft">
                                <a th:href="@{|/product/detail/${p.productid}|}" th:text="${p.productname}" style="color: black; text-decoration: none;"></a>
                                <div>
                                    <b th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></b>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <br>
            <div class=" mb-3">
                <h1>ĐÁNH GIÁ SẢN PHẨM</h1>
            </div>

            <div class="row ">
                <div class="col-xl-10 col-lg-8 col-md-10 col-12 text-center">
                    <div class="card">
                        <div class="row justify-content-left d-flex">
                            <div class="col-md-6 d-flex flex-column">
                                <div class="rating-box">
                                    <h1 class="pt-4">4.0</h1>
                                    <p class="">out of 5</p>
                                </div>
                                <div>
                                    <span class="fa fa-star star-active mx-1"></span> <span class="fa fa-star star-active mx-1"></span> <span class="fa fa-star star-active mx-1"></span> <span class="fa fa-star star-active mx-1"></span> <span class="fa fa-star star-inactive mx-1"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="rating-bar0 justify-content-center">
                                    <table class="text-left mx-auto">
                                        <tr>
                                            <td class="rating-label">5</td>
                                            <td class="rating-bar">
                                                <div class="bar-container">
                                                    <div class="bar-5"></div>
                                                </div>
                                            </td>
                                            <td class="text-right">123</td>
                                        </tr>
                                        <tr>
                                            <td class="rating-label">4</td>
                                            <td class="rating-bar">
                                                <div class="bar-container">
                                                    <div class="bar-4"></div>
                                                </div>
                                            </td>
                                            <td class="text-right">23</td>
                                        </tr>
                                        <tr>
                                            <td class="rating-label">3</td>
                                            <td class="rating-bar">
                                                <div class="bar-container">
                                                    <div class="bar-3"></div>
                                                </div>
                                            </td>
                                            <td class="text-right">10</td>
                                        </tr>
                                        <tr>
                                            <td class="rating-label">2</td>
                                            <td class="rating-bar">
                                                <div class="bar-container">
                                                    <div class="bar-2"></div>
                                                </div>
                                            </td>
                                            <td class="text-right">3</td>
                                        </tr>
                                        <tr>
                                            <td class="rating-label">1</td>
                                            <td class="rating-bar">
                                                <div class="bar-container">
                                                    <div class="bar-1"></div>
                                                </div>
                                            </td>
                                            <td class="text-right">0</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>


                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
							Đánh giá giúp chúng tôi !</button>

                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="card">
                                            <div class="modal-header">
                                                <<<<<<< HEAD <h1 class="modal-title fs-6 text-center" id="exampleModalLabel">GreenFarm xin được cám ơn quý khách!
                                                    </h1>
                                                    =======
                                                    <h1 class="modal-title fs-6 text-center" id="exampleModalLabel">
                                                        GreenFarm xin được cám ơn quý khách!</h1>
                                                    >>>>>>> 3c2ebaf00ff54504be59fa9da74d242873db299f
                                            </div>
                                            <div class="card-body">
                                                <form th:action="@{'/product/detail/' + ${productid}}" th:object="${reviewinsert}" method="post">
                                                    <fieldset style="font-size: 40px;" class="rating" th:field="*{rating}">
                                                        <input type="radio" id="star5" name="rating" value="5" /><label class="full" for="star5"></label> <input type="radio" id="star4" name="rating" value="4" /><label class="full" for="star4"></label>                                                        <input type="radio" id="star3" name="rating" value="3" /><label class="full" for="star3"></label> <input type="radio" id="star2" name="rating" value="2" /><label class="full" for="star2"></label>                                                        <input type="radio" id="star1" name="rating" value="1" /><label class="full" for "star1"></label>
                                                    </fieldset>


                                                    <div class="form-outline">
                                                        <textarea th:field="*{content}" class="form-control" id="textAreaExample" rows="4"></textarea>

                                                    </div>
                                                    <div class="d-flex justify-content-between mt-3">
                                                        <button type="submit" class="btn btn-danger">
															Gửi đánh giá <i id="review-button"
																class="fas fa-long-arrow-alt-right ms-1"></i>
														</button>
                                                    </div>
                                                </form>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="modal" class="modal" tabindex="-1">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Đánh giá</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p id="modal-message"></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>


                <div id="review-section" class="col-md-10">
                    <div th:each="review : ${review}" class="cardrating">
                        <div class="row ">
                            <div class="col-md-6">
                                <img style="width: 50px; height: 50px" class="profile-pic" th:src="@{|/assetsAdmin/images/${review.user.image}|}" alt="User Image" th:text="${review.user.email}" />

                            </div>

                            <div class="col-md-6" th:if="${#authorization.expression('isAuthenticated()')}">
                                <button style="float: right;" class="btn btn-danger" th:if="${#authorization.expression(review.user.email == #authentication.principal.username)}">
									<a
										th:href="@{'/product/detail/' + ${productid} + '/delete/' + ${review.reviewid}}">Xóa</a>
								</button>
                            </div>

                            <div class=" d-flex flex-column">
                                <div>
                                    <span class="fa fa-star star-active" th:each="i : ${#numbers.sequence(1, review.rating)}"></span> <span class="fa fa-star-half star-active" th:if="${review.rating % 1 != 0}"></span>
                                    <span class="fa fa-star star-inactive" th:each="i : ${#numbers.sequence(review.rating.floatValue() +1,5)}">
									</span>
                                </div>
                                <div>
                                    <span th:text="${review.product.category.categoryname}"></span> | <span th:text="${review.datepost}" class=""></span>
                                </div>

                            </div>
                        </div>
                        <div class="row text-left">
                            <p style="font-family: Arial, Helvetica, sans-serif" class="content" th:text="${review.content}"></p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <<<<<<< HEAD <script>
        // Lấy nút "Đánh giá" theo id const reviewButton = document.getElementById("review-button"); // Lấy phần tử chứa danh sách đánh giá theo id const reviewSection = document.getElementById("review-section"); // Thêm sự kiện bấm vào nút "Đánh giá" reviewButton.addEventListener("click",
        function() { // Cuộn đến phần tử chứa danh sách đánh giá reviewSection.scrollIntoView({ behavior : "smooth" }); });
        </script>



        =======
        <script>
            $(document).ready(function() {
                $('form').submit(function(event) {
                    // Ngăn chặn chuyển hướng trình duyệt khi gửi form
                    event.preventDefault();

                    // Lấy dữ liệu từ form
                    var formData = $(this).serialize();

                    // Gửi yêu cầu Ajax để lưu đánh giá
                    $.ajax({
                        type: 'POST',
                        url: $(this).attr('action'),
                        data: formData,
                        success: function(response) {
                            // Phân tích chuỗi JSON và trích xuất thông báo thành công
                            var responseJSON = JSON.parse(response);
                            var successMessage = responseJSON.successMessage;
                            var errorMessage = responseJSON.errorMessage;

                            $('.alert').hide();


                            if (errorMessage) {
                                // Hiển thị thông báo lỗi bên dưới form
                                $('.alert-danger').text(errorMessage).show();
                            } else {
                                // Hiển thị thông báo thành công trong modal
                                $('#modal-message').text(successMessage);
                                $('#exampleModal').modal('hide');
                                $('#modal').modal('show');
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            // Hiển thị thông báo lỗi trong alert
                            $('.alert-danger').text(jqXHR.responseText).show();
                            //						alert(jqXHR.responseText);
                        }
                    });
                });
                $('#exampleModal').on('hidden.bs.modal', function(e) {
                    $(this).remove();
                });
                $('#modal').on('hidden.bs.modal', function(event) {
                    // Chuyển hướng sang trang mới
                    location.reload();
                });
            });
        </script>
        >>>>>>> 3c2ebaf00ff54504be59fa9da74d242873db299f
</body>

</html>