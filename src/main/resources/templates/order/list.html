
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/layout/layout :: dynamic(~{::body})}">

<head>
<meta charset="utf-8">
<title>Insert title here</title>
</head>

<body>
	<main>
		<div class="">
			<div class="row mt-5">
				<div class="col-sm-4">
					<div class="menu mx-3">
						<span>Tên User</span>
						<ul class="list-group border border-0 rounded-0 my-3">

							<li class="list-group-item"
								style="background: #e4e7ed; border-radius: 4px;"><i
								class="bi bi-card-list"></i> Đơn hàng đã mua</li>
							<li class="list-group-item mt-3"
								style="background: #e4e7ed; border-radius: 4px;"><i
								class="bi bi-person-lines-fill"></i> Thông tin và sổ địa chỉ</li>

						</ul>
						<a
							class=" btn border border-danger my-3 text-decoration-none text-center text-danger fw-bold"
							style="width: 100%">Đăng xuất</a>
						<div class="card mt-3" style="background-color: #fff;">
							<div class="card-header">Tổng điểm tích lũy: 180.616 điểm</div>
							<div class="card-body">
								<div class="row">
									<div class="col-sm-8">
										<small>Tích & sử dụng điểm cho khách hàng thân thiết.
											Sản phẩm của tập đoàn MWG. Tìm hiểu thêm</small>

									</div>
									<div class="col-sm-4">

										<img src="" alt="Quét mã QR">
									</div>

								</div>
								<div class="">
									<a href="#" class="btn mt-3" style="background-color: #AAAAAA">Dowload
										App Store</a>
								</div>
							</div>
						</div>
					</div>


				</div>
				<div class="col-sm-8">
					<h6>Đơn hàng đã mua:</h6>

<!-- 					<div class="col-md-4 input-group icons"> -->
<!-- 						<select class="select" style="width: 200px;" -->
<!-- 							ng-model="selectedStatus"> -->
<!-- 							<option value="1">Chờ xác nhận</option> -->
<!-- 							<option value="2">Đang giao</option> -->
<!-- 							<option value="3">Giao hàng thành công</option> -->
<!-- 							<option value="4">Đã hủy</option> -->
<!-- 						</select> -->
<!-- 					</div> -->


					<div th:each="order, state:${orders}">



						<div class="card border border-0 rounded-0 mt-3"
							style="padding: 20px; width: auto; border-radius: 3px; background-color: #fff; font-size: 14px; flex-direction: column;">
							<div class="card-header" style="background-color: #fff;">
								<span class="fw-bold">Đơn hàng:</span> #[[${order.orderid}]]

								<!-- 								<span class="fw-bold">-- Giao Trước 11:00 *[[${order.orderdate}]] </span>  -->
								<span class="fw-bold">-- Giao Trước 11:00 *Ngày:
									[[${order.getOrderDateFormatted()}]] </span> <span
									th:if="${order.statusOrder.name} =='Đã hủy'"
									class="float-end text-danger fw-bold">
									[[${order.statusOrder.name}]] </span> <span
									th:if="${order.statusOrder.name} !='Đã hủy'"
									class="float-end text-success fw-bold">
									[[${order.statusOrder.name}]] </span>
							</div>
							<div class="row g-0 mt-1"
								th:each="orderDetail : ${order.orderDetail}">
								<div class="col-md-2">
									<img th:src="*{orderDetail.product.image}" class="img-fluid"
										alt="...">
								</div>
								<div class="col-md-10">
									<div class="card-body">
										<span> <span
											th:text="${orderDetail.product.productname}"></span><br>
											<span
											th:text="'Số lượng: '+${orderDetail.quantityordered}+'kg'"></span>
											<!-- 											<span th:text="${#numbers.formatDecimal(orderDetail.product.price, 0, 'COMMA', 0, -->
											<!-- 											'POINT')}+'đ'"></span> -->
										</span>

									</div>

								</div>
							</div>
							<div class="float-end">

								<span th:if="*{order.statusOrder.name} == 'Chờ xác nhận'">

									<button th:id="'cancelButton_' + ${order.orderid}"
										class="cancel-button btn mt-3 text-danger float-end btn-white border border-danger ms-2">Hủy
										đơn</button>
								</span> <a th:href="@{|/order/detail/${order.orderid}|}"
									class="btn mt-3 text-success float-end  border border-success">Xem
									chi tiết</a>

							</div>

						</div>

					</div>


				</div>
			</div>
		</div>
		<script>
			// Lấy tất cả các nút "Hủy đơn" bằng class
			var cancelButtons = document.querySelectorAll('.cancel-button');

			// Thêm sự kiện click cho mỗi nút "Hủy đơn"
			cancelButtons.forEach(function (button) {
				button.addEventListener('click', function () {
					var orderId = this.id.split('_')[1]; // Lấy orderId từ id của nút

					// Gửi yêu cầu PUT đến server
					fetch(`/rest/orders/cancel/${orderId}`, {
						method: 'PUT',
					})
						.then(function (response) {
							if (response.status === 200) {
								// Nếu thành công, bạn có thể thực hiện các tác vụ sau khi đổi trạng thái
								alert('Đã hủy đơn hàng thành công');								
								location.reload();
							} else {
								// Xử lý lỗi
								response.text().then(function (errorMessage) {
									console.error('Lỗi khi hủy đơn hàng: ' + errorMessage);
								});
							}
						})
						.catch(function (error) {
							console.error('Lỗi khi gửi yêu cầu: ' + error);
						});
				});
			});
		</script>

		<script>
		    document.addEventListener("DOMContentLoaded", function () {
		        const orderStatusFilter = document.getElementById("orderStatusFilter");
		        const orders = document.querySelectorAll("[th:each='order, state:${orders}']");
		
		        orderStatusFilter.addEventListener("change", function () {
		            const selectedStatus = orderStatusFilter.value;
		
		            orders.forEach(function (order) {
		                const orderStatus = order.querySelector("[th:if='${order.statusOrder.name}']");
		                if (selectedStatus === "" || selectedStatus === orderStatus.innerText.trim()) {
		                    order.style.display = "block";
		                } else {
		                    order.style.display = "none";
		                }
		            });
		        });
		    });
	</script>


	</main>
</body>

</html>